import java.text.SimpleDateFormat

description 'web3j is a lightweight Java library for integration with Ethereum clients'

dependencies {
    compile project(':alaya-solidity-abi'),
            project(':alaya-wasm-abi'),
            project(':alaya-crypto'),
            project(':alaya-tuples'),
            "com.github.jnr:jnr-unixsocket:$jnr_unixsocketVersion",
            "com.squareup.okhttp3:okhttp:$okhttpVersion",
            "com.squareup.okhttp3:logging-interceptor:$okhttpVersion",
            "io.reactivex:rxjava:$rxjavaVersion",
            "com.alibaba:fastjson:1.2.54",
            "org.java-websocket:Java-WebSocket:$javaWebSocketVersion"
    testCompile project(path: ':alaya-crypto', configuration: 'testArtifacts'),
            "nl.jqno.equalsverifier:equalsverifier:$equalsverifierVersion",
            "ch.qos.logback:logback-classic:$logbackVersion"
    testCompile group: 'org.projectlombok', name: 'lombok', version: '1.18.6'

}

task createProperties(dependsOn: processResources) doLast {
    // if resources dir is empty we need to create this ourselves
    new File("$buildDir/resources/main/").mkdirs()

    new File("$buildDir/resources/main/web3j-version.properties").withWriter { w ->
        Properties p = new Properties()
        p['version'] = project.version.toString()
        p['timestamp'] = getTimestamp()
        p.store w, null
    }
}

def getTimestamp() {
    Date today = new Date()
    SimpleDateFormat df = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss.S z")
    df.setTimeZone(TimeZone.getTimeZone("UTC"))
    return df.format(today)
}

classes {
    dependsOn createProperties
}

configurations {
    testArtifacts.extendsFrom testRuntime
}

artifacts {
    testArtifacts testJar
}
